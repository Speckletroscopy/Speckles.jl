\documentclass[12pt,a4paper]{article}

\usepackage[a4paper,text={16.5cm,25.2cm},centering]{geometry}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{bm}
\usepackage{graphicx}
\usepackage{microtype}
\usepackage{hyperref}
\setlength{\parindent}{0pt}
\setlength{\parskip}{1.2ex}

\hypersetup
       {   pdfauthor = {  },
           pdftitle={  },
           colorlinks=TRUE,
           linkcolor=black,
           citecolor=blue,
           urlcolor=blue
       }




\usepackage{upquote}
\usepackage{listings}
\usepackage{xcolor}
\lstset{
    basicstyle=\ttfamily\footnotesize,
    upquote=true,
    breaklines=true,
    breakindent=0pt,
    keepspaces=true,
    showspaces=false,
    columns=fullflexible,
    showtabs=false,
    showstringspaces=false,
    escapeinside={(*@}{@*)},
    extendedchars=true,
}
\newcommand{\HLJLt}[1]{#1}
\newcommand{\HLJLw}[1]{#1}
\newcommand{\HLJLe}[1]{#1}
\newcommand{\HLJLeB}[1]{#1}
\newcommand{\HLJLo}[1]{#1}
\newcommand{\HLJLk}[1]{\textcolor[RGB]{148,91,176}{\textbf{#1}}}
\newcommand{\HLJLkc}[1]{\textcolor[RGB]{59,151,46}{\textit{#1}}}
\newcommand{\HLJLkd}[1]{\textcolor[RGB]{214,102,97}{\textit{#1}}}
\newcommand{\HLJLkn}[1]{\textcolor[RGB]{148,91,176}{\textbf{#1}}}
\newcommand{\HLJLkp}[1]{\textcolor[RGB]{148,91,176}{\textbf{#1}}}
\newcommand{\HLJLkr}[1]{\textcolor[RGB]{148,91,176}{\textbf{#1}}}
\newcommand{\HLJLkt}[1]{\textcolor[RGB]{148,91,176}{\textbf{#1}}}
\newcommand{\HLJLn}[1]{#1}
\newcommand{\HLJLna}[1]{#1}
\newcommand{\HLJLnb}[1]{#1}
\newcommand{\HLJLnbp}[1]{#1}
\newcommand{\HLJLnc}[1]{#1}
\newcommand{\HLJLncB}[1]{#1}
\newcommand{\HLJLnd}[1]{\textcolor[RGB]{214,102,97}{#1}}
\newcommand{\HLJLne}[1]{#1}
\newcommand{\HLJLneB}[1]{#1}
\newcommand{\HLJLnf}[1]{\textcolor[RGB]{66,102,213}{#1}}
\newcommand{\HLJLnfm}[1]{\textcolor[RGB]{66,102,213}{#1}}
\newcommand{\HLJLnp}[1]{#1}
\newcommand{\HLJLnl}[1]{#1}
\newcommand{\HLJLnn}[1]{#1}
\newcommand{\HLJLno}[1]{#1}
\newcommand{\HLJLnt}[1]{#1}
\newcommand{\HLJLnv}[1]{#1}
\newcommand{\HLJLnvc}[1]{#1}
\newcommand{\HLJLnvg}[1]{#1}
\newcommand{\HLJLnvi}[1]{#1}
\newcommand{\HLJLnvm}[1]{#1}
\newcommand{\HLJLl}[1]{#1}
\newcommand{\HLJLld}[1]{\textcolor[RGB]{148,91,176}{\textit{#1}}}
\newcommand{\HLJLs}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsa}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsb}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsc}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsd}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsdB}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsdC}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLse}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLsh}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsi}[1]{#1}
\newcommand{\HLJLso}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsr}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLss}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLssB}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLnB}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLnbB}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLnfB}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLnh}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLni}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLnil}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLnoB}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLoB}[1]{\textcolor[RGB]{102,102,102}{\textbf{#1}}}
\newcommand{\HLJLow}[1]{\textcolor[RGB]{102,102,102}{\textbf{#1}}}
\newcommand{\HLJLp}[1]{#1}
\newcommand{\HLJLc}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLch}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLcm}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLcp}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLcpB}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLcs}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLcsB}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLg}[1]{#1}
\newcommand{\HLJLgd}[1]{#1}
\newcommand{\HLJLge}[1]{#1}
\newcommand{\HLJLgeB}[1]{#1}
\newcommand{\HLJLgh}[1]{#1}
\newcommand{\HLJLgi}[1]{#1}
\newcommand{\HLJLgo}[1]{#1}
\newcommand{\HLJLgp}[1]{#1}
\newcommand{\HLJLgs}[1]{#1}
\newcommand{\HLJLgsB}[1]{#1}
\newcommand{\HLJLgt}[1]{#1}


\begin{document}



\section{Running the simulation}
\subsection{Load up \texttt{Speckles.jl}}

\begin{lstlisting}
(*@\HLJLk{using}@*) (*@\HLJLn{Speckles}@*)
\end{lstlisting}


\subsection{Provide dictionary with parameters}
\begin{itemize}
\item Each parameter must be an array

\end{itemize}

\begin{lstlisting}
(*@\HLJLn{\ensuremath{\nu}H\ensuremath{\alpha}2}@*) (*@\HLJLoB{=}@*) (*@\HLJLp{[}@*)(*@\HLJLni{456810}@*)(*@\HLJLp{,}@*)(*@\HLJLni{456813}@*)(*@\HLJLp{]}@*) (*@\HLJLcs{{\#}GHz}@*)
(*@\HLJLn{paramDict}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{Dict}@*)(*@\HLJLp{(}@*)
                (*@\HLJLsc{:n}@*)    (*@\HLJLoB{=>}@*) (*@\HLJLnf{collect}@*)(*@\HLJLp{(}@*)(*@\HLJLni{10}@*)(*@\HLJLoB{:}@*)(*@\HLJLni{10}@*)(*@\HLJLoB{:}@*)(*@\HLJLni{100}@*)(*@\HLJLp{),}@*)(*@\HLJLcs{{\#}}@*) (*@\HLJLcs{number}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{atoms}@*)
                (*@\HLJLsc{:\ensuremath{\nu}m}@*)   (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLn{\ensuremath{\nu}H\ensuremath{\alpha}2}@*)(*@\HLJLp{],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{line}@*) (*@\HLJLcs{frequencies}@*) (*@\HLJLcs{in}@*) (*@\HLJLcs{GHz}@*)
                (*@\HLJLsc{:Em}@*)   (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLs{"{}ones"{}}@*)(*@\HLJLp{],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{relative}@*) (*@\HLJLcs{line}@*) (*@\HLJLcs{magnitudes}@*)
                (*@\HLJLsc{:\ensuremath{\sigma}}@*)    (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{20.0}@*)(*@\HLJLp{],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{Doppler}@*) (*@\HLJLcs{broadening}@*) (*@\HLJLcs{in}@*) (*@\HLJLcs{GHz}@*)
                (*@\HLJLsc{:f\ensuremath{\gamma}}@*)   (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{2.0e6}@*)(*@\HLJLp{],}@*)(*@\HLJLcs{{\#},"{}shot10{\%}"{},"{}shot50{\%}"{},10.0,1.0,0.16],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{mean}@*) (*@\HLJLcs{photon}@*) (*@\HLJLcs{count}@*) (*@\HLJLcs{rate}@*) (*@\HLJLcs{in}@*) (*@\HLJLcs{GHz}@*)
                (*@\HLJLsc{:deadtime}@*)   (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{0.0}@*)(*@\HLJLp{],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{detector}@*) (*@\HLJLcs{deadtime}@*) (*@\HLJLcs{in}@*) (*@\HLJLcs{nanoseconds}@*)
                (*@\HLJLsc{:resolution}@*) (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{0.010}@*)(*@\HLJLp{],}@*)(*@\HLJLcs{{\#},0.10],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{detector}@*) (*@\HLJLcs{resolution}@*) (*@\HLJLcs{in}@*) (*@\HLJLcs{nanoseconds}@*)
                (*@\HLJLsc{:jitter}@*)     (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{0.015}@*)(*@\HLJLp{],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{detector}@*) (*@\HLJLcs{timing}@*) (*@\HLJLcs{jitter}@*) (*@\HLJLcs{in}@*) (*@\HLJLcs{nanoseconds}@*) 
                (*@\HLJLsc{:efficiency}@*) (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{0.9}@*)(*@\HLJLp{],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{detector}@*) (*@\HLJLcs{efficiency}@*)
                (*@\HLJLsc{:darkcounts}@*) (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{1.0e-8}@*)(*@\HLJLp{],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{detector}@*) (*@\HLJLcs{dark}@*) (*@\HLJLcs{count}@*) (*@\HLJLcs{rate}@*) (*@\HLJLcs{in}@*) (*@\HLJLcs{GHz}@*)
                (*@\HLJLsc{:duration}@*)   (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{20.0}@*)(*@\HLJLp{],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{duration}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{correlation}@*) (*@\HLJLcs{measurement}@*) (*@\HLJLcs{in}@*) (*@\HLJLcs{nanoseconds}@*)
                (*@\HLJLsc{:window}@*)     (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLs{"{}halfwindow"{}}@*)(*@\HLJLp{],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{time}@*) (*@\HLJLcs{over}@*) (*@\HLJLcs{which}@*) (*@\HLJLcs{to}@*) (*@\HLJLcs{average}@*) (*@\HLJLcs{correlations}@*) (*@\HLJLcs{in}@*) (*@\HLJLcs{nanoseconds}@*)
                (*@\HLJLsc{:repeat}@*)     (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLni{100}@*)(*@\HLJLp{],}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{number}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{times}@*) (*@\HLJLcs{to}@*) (*@\HLJLcs{repeat}@*) (*@\HLJLcs{correlation}@*) (*@\HLJLcs{measurement}@*)
                (*@\HLJLsc{:reinstance}@*) (*@\HLJLoB{=>}@*) (*@\HLJLp{[}@*)(*@\HLJLkc{true}@*)(*@\HLJLp{]}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{control}@*) (*@\HLJLcs{whether}@*) (*@\HLJLcs{or}@*) (*@\HLJLcs{not}@*) (*@\HLJLcs{frequencies}@*) (*@\HLJLcs{and}@*) (*@\HLJLcs{phases}@*) (*@\HLJLcs{should}@*) (*@\HLJLcs{be}@*) (*@\HLJLcs{reinstanced}@*) (*@\HLJLcs{between}@*) (*@\HLJLcs{measurements}@*)
                (*@\HLJLp{)}@*)
\end{lstlisting}

\begin{lstlisting}
Dict(*@{{\{}}@*)Symbol, Vector(*@{{\{}}@*)T(*@{{\}}}@*) where T(*@{{\}}}@*) with 14 entries:
  :n          => [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]
  :jitter     => [0.015]
  :reinstance => Bool[1]
  :duration   => [20.0]
  :f(*@\ensuremath{\gamma}@*)         => [2.0e6]
  :efficiency => [0.9]
  :(*@\ensuremath{\sigma}@*)          => [20.0]
  :window     => [(*@{"{}}@*)halfwindow(*@{"{}}@*)]
  :darkcounts => [1.0e-8]
  :resolution => [0.01]
  :(*@\ensuremath{\nu}@*)m         => [[456810, 456813]]
  :Em         => [(*@{"{}}@*)ones(*@{"{}}@*)]
  :deadtime   => [0.0]
  :repeat     => [100]
\end{lstlisting}


\subsection{Run the simulation and access the dictionary}
\begin{itemize}
\item Takes all combinations of parameters possible with given arrays and runs each as a simulation


\item Appends the results of the simulation in the simulation database


\item Each series of simulations gets its own id


\item Each simulation gets its own id


\item Each simulation, its parameters, and its results gets its own row in the database


\item Plots and data are stored in a directory with the same name as the simulation


\item Returned table contains parameters from the current series of simulations


\item All simulation can be retrieved with \texttt{load\_db()}

\end{itemize}

\begin{lstlisting}
(*@\HLJLn{tbl}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{Speckles}@*)(*@\HLJLoB{.}@*)(*@\HLJLnf{run}@*)(*@\HLJLp{(}@*)(*@\HLJLn{paramDict}@*)(*@\HLJLp{)}@*)
\end{lstlisting}

\begin{lstlisting}
Error: MethodError: no method matching Speckles.SpeckleSim(::DateTime, ::Ba
se.UUID, ::Speckles.SpeckleParams(*@{{\{}}@*)Float64(*@{{\}}}@*), ::Speckles.Beamsplitter, ::Floa
t64, ::Vector(*@{{\{}}@*)Speckles.SpeckleReadout(*@{{\}}}@*), ::Vector(*@{{\{}}@*)Speckles.Correlation(*@{{\}}}@*))
\end{lstlisting}


\subsection{Select data from the table}
\begin{itemize}
\item Get the latest run

\end{itemize}

\begin{lstlisting}
(*@\HLJLcs{{\#}}@*) (*@\HLJLcs{sort}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{table}@*) (*@\HLJLcs{by}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{number}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{atoms}@*) (*@\HLJLcs{for}@*) (*@\HLJLcs{plotting}@*) (*@\HLJLcs{reasons}@*)
(*@\HLJLn{tbl{\_}nsort}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{sort}@*)(*@\HLJLp{(}@*)(*@\HLJLn{tbl}@*)(*@\HLJLp{,}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{n}@*)(*@\HLJLp{)}@*)

(*@\HLJLcs{{\#}}@*) (*@\HLJLcs{get}@*) (*@\HLJLcs{column}@*) (*@\HLJLcs{with}@*) (*@\HLJLcs{number}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{atoms}@*)
(*@\HLJLn{nvals}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{select}@*)(*@\HLJLp{(}@*)(*@\HLJLn{tbl{\_}nsort}@*)(*@\HLJLp{,}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{n}@*)(*@\HLJLp{)}@*)

(*@\HLJLcs{{\#}}@*) (*@\HLJLcs{get}@*) (*@\HLJLcs{snr}@*) (*@\HLJLcs{columns}@*)

(*@\HLJLn{cols{\_}str}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{string}@*)(*@\HLJLoB{.}@*)(*@\HLJLp{(}@*)(*@\HLJLnf{colnames}@*)(*@\HLJLp{(}@*)(*@\HLJLn{tbl}@*)(*@\HLJLp{))}@*)
(*@\HLJLn{singlecols}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{occursin}@*)(*@\HLJLoB{.}@*)(*@\HLJLp{(}@*)(*@\HLJLs{"{}single"{}}@*)(*@\HLJLp{,}@*)(*@\HLJLn{cols{\_}str}@*)(*@\HLJLp{)}@*)
(*@\HLJLn{singlecols}@*) (*@\HLJLoB{=}@*) (*@\HLJLp{[}@*)(*@\HLJLn{singlecols}@*)(*@\HLJLoB{...}@*)(*@\HLJLp{]}@*)
(*@\HLJLn{single{\_}colnames{\_}str}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{cols{\_}str}@*)(*@\HLJLp{[}@*)(*@\HLJLn{singlecols}@*)(*@\HLJLp{]}@*)
(*@\HLJLn{single{\_}snr{\_}cols}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{Symbol}@*)(*@\HLJLoB{.}@*)(*@\HLJLp{(}@*)(*@\HLJLn{single{\_}colnames{\_}str}@*)(*@\HLJLp{)}@*)
(*@\HLJLn{plt}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{plot}@*)(*@\HLJLp{()}@*)
(*@\HLJLk{for}@*) (*@\HLJLn{col}@*) (*@\HLJLkp{in}@*) (*@\HLJLn{single{\_}snr{\_}cols}@*)
    (*@\HLJLnf{plot!}@*)(*@\HLJLp{(}@*)(*@\HLJLn{plt}@*)(*@\HLJLp{,}@*)(*@\HLJLn{nvals}@*)(*@\HLJLp{,}@*)(*@\HLJLnf{select}@*)(*@\HLJLp{(}@*)(*@\HLJLn{tbl{\_}nsort}@*)(*@\HLJLp{,}@*)(*@\HLJLn{col}@*)(*@\HLJLp{),}@*)(*@\HLJLn{label}@*)(*@\HLJLoB{=}@*)(*@\HLJLnf{string}@*)(*@\HLJLp{(}@*)(*@\HLJLn{col}@*)(*@\HLJLp{))}@*)
(*@\HLJLk{end}@*)
(*@\HLJLnf{plot!}@*)(*@\HLJLp{(}@*)(*@\HLJLn{plt}@*)(*@\HLJLp{,}@*)(*@\HLJLn{title}@*)(*@\HLJLoB{=}@*)(*@\HLJLs{"{}SNR}@*) (*@\HLJLs{for}@*) (*@\HLJLs{single}@*) (*@\HLJLs{correlation}@*) (*@\HLJLs{simulation"{}}@*)(*@\HLJLp{)}@*)
\end{lstlisting}

\begin{lstlisting}
Error: UndefVarError: tbl not defined
\end{lstlisting}


Let's save that bad boy too!


\begin{lstlisting}
(*@\HLJLnf{savefig}@*)(*@\HLJLp{(}@*)(*@\HLJLn{plt}@*)(*@\HLJLp{,}@*)(*@\HLJLs{"{}badboy.svg"{}}@*)(*@\HLJLp{)}@*)
\end{lstlisting}

\begin{lstlisting}
Error: UndefVarError: plt not defined
\end{lstlisting}



\end{document}
